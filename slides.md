---
theme: academic
background: #1e293b
title: Scalaã®é–¢æ•°å‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ãŸå‹å®‰å…¨ãªæ¥­å‹™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º
info: |
  ## Scalaã®é–¢æ•°å‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ãŸå‹å®‰å…¨ãªæ¥­å‹™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º
  é–¢æ•°å‹ã¾ã¤ã‚Š 2025ã§ã®ç™ºè¡¨è³‡æ–™
  
  Scalaã®å¼·å›ºãªå‹ã‚·ã‚¹ãƒ†ãƒ ã¨é–¢æ•°å‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ã¦ã€
  å‹å®‰å…¨ã§ä¿å®ˆæ€§ã®é«˜ã„æ¥­å‹™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
class: text-center
drawings:
  persist: false
transition: slide-left
mdc: true
colorSchema: 'light'
coverDate: false
css: unocss
---

<style>
  @import './style.css';
</style>

# Scalaã®é–¢æ•°å‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ãŸå‹å®‰å…¨ãª<br/>æ¥­å‹™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º

<div class="pt-12">
  <span class="text-white">
    é–¢æ•°å‹ã¾ã¤ã‚Š 2025
  </span>
</div>

<div class="pt-4">
  <span class="text-white/80 text-sm">
    2025å¹´6æœˆ15æ—¥
  </span>
</div>

<style>
  .slidev-layout {
    background: #1e293b;
  }
  .slidev-page-1 h1 {
    color: white !important;
    font-size: 1.875rem !important;
    line-height: 1.4 !important;
    font-weight: 700 !important;
    max-width: 90%;
    margin: 0 auto;
  }
  h1 {
    color: white;
    font-size: 1.875rem;
    line-height: 1.4;
    font-weight: 700;
  }
</style>

---
layout: intro
class: text-center
---

# è‡ªå·±ç´¹ä»‹

<div class="my-10 grid grid-cols-1 gap-4">
  <div class="flex items-center justify-center gap-4">
    <img src="/images/icon.png" class="w-20 h-20 rounded-full" />
    <div class="text-left">
      <div class="text-xl font-bold">Tomoki Mizogami</div>
      <div class="text-sm opacity-70">æ ªå¼ä¼šç¤¾ãƒã‚¯ã‚¹ãƒˆãƒ“ãƒ¼ãƒˆ</div>
      <div class="text-sm opacity-70">Webã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼ˆScalaæ­´6å¹´ï¼‰ã€ğŸ”°PdM</div>
    </div>
  </div>
</div>

<div class="my-8">
  <ul class="list-disc text-left max-w-2xl mx-auto space-y-2 pl-6">
    <li>æ–°è¦äº‹æ¥­é–‹ç™ºãƒ»å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºãƒ»èªè¨¼åŸºç›¤ç­‰ã‚’æ‹…å½“</li>
    <li>å¥½ããªè¨€èª ã‚¹ãƒšã‚¤ãƒ³èªğŸ‡ªğŸ‡¸</li>
    <li><a href="https://criceta.com/category-theory-with-scala/" target="_blank">Scalaã§å§‹ã‚ã‚‹åœè«–å…¥é–€</a></li>
  </ul>
  <div class="text-sm opacity-70 mt-6">
    <a href="https://x.com/taretmch" target="_blank" class="mr-4">@taretmch</a>
    <a href="https://github.com/taretmch" target="_blank">GitHub</a>
  </div>
</div>

---
layout: default
---

# ä¼šç¤¾ç´¹ä»‹

<img src="/images/nextbeat.png" class="absolute top-16 right-16 h-16" alt="æ ªå¼ä¼šç¤¾ãƒã‚¯ã‚¹ãƒˆãƒ“ãƒ¼ãƒˆ" />

<div class="mb-6">
  <h2 class="text-2xl font-bold">æ ªå¼ä¼šç¤¾ãƒã‚¯ã‚¹ãƒˆãƒ“ãƒ¼ãƒˆ <span class="text-base font-normal text-gray-600">(ã‚·ãƒ«ãƒãƒ¼ã‚¹ãƒãƒ³ã‚µãƒ¼)</span></h2>
</div>

### ãƒŸãƒƒã‚·ãƒ§ãƒ³

ã€Œäººå£æ¸›å°‘ç¤¾ä¼šã«ãŠã„ã¦å¿…è¦ã¨ã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆäº‹æ¥­ã‚’å‰µé€ ã—ã€ãƒ‹ãƒƒãƒãƒ³ã‚’å…ƒæ°—ã«ã™ã‚‹ã€‚ã€

### äº‹æ¥­é ˜åŸŸ

- **ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆ**: ä¿è‚²åœ’/æ³•äººå‘ã‘SaaSã€ãƒ™ãƒ“ãƒ¼ã‚·ãƒƒã‚¿ãƒ¼äº‹æ¥­ã€å­è‚²ã¦ãƒ¡ãƒ‡ã‚£ã‚¢ã€æ±‚äººæƒ…å ±ãƒ»è»¢è·æ”¯æ´ etc.
- **åœ°æ–¹å‰µç”Ÿ**: å®¿æ³Šæ¥­ç•Œå‘ã‘æ±‚äººæƒ…å ±ãƒ»è»¢è·æ”¯æ´ etc.
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«**: ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«äº‹æ¥­ã€å°æ¹¾äº‹æ¥­ etc.

<br/>

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Scala, TypeScript (Svelte, NestJS, Angular, ...), ...

---
layout: image
image: ./images/nextbeat_hub.png
backgroundSize: cover
---

# Nextbeat Hub ã®ç´¹ä»‹

<ul>
  <li>æ¯é€±æœ¨æ›œæ—¥20:00ã€œ21:30</li>
  <li>ãƒã‚¯ã‚¹ãƒˆãƒ“ãƒ¼ãƒˆã®ç¤¾å“¡ã¨ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«è©±ã›ã‚‹å ´</li>
  <li>é–¢æ•°å‹ã®è©±ã€å¤§æ­“è¿ã§ã™</li>
</ul>

<img src="./images/nextbeat_hub_qr.png" style="position: absolute; bottom: 20px; right: 20px; width: 150px; height: 150px;" />

<style>
h1 {
  color: white;
}
li {
  font-size: 1.2rem;
  color: white;
}
</style>

---
layout: center
---

# æœ¬æ—¥ã®ãƒ†ãƒ¼ãƒ

<div class="text-center">
  <p style="text-align: left;">Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢æ•°å‹ã®è€ƒãˆæ–¹ã‚’å–ã‚Šå…¥ã‚Œã€<span v-mark.underline.red>å‹å®‰å…¨ã«</span>é–‹ç™ºã™ã‚‹</p>
  <p style="text-align: left;">ãã®ãŸã‚ã®åŸºæœ¬è¦ç´ ã‚’ã”ç´¹ä»‹ã—ã¾ã™</p>
</div>

---
layout: center
class: text-center
---

# ã€Œå‹å®‰å…¨ã€

<div class="mt-16 grid grid-cols-2 gap-12">
  <div class="transform transition-all duration-300 hover:scale-105 text-center">
    <div class="text-6xl mb-4">ğŸ›¡ï¸</div>
    <h2 class="text-3xl font-bold text-blue-600">ä¸æ­£ãªå€¤ã‚’ä½œã‚‰ã›ãªã„</h2>
    <p class="text-xl text-gray-600 mt-2">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¸æ­£ãªçŠ¶æ…‹ã‚’æ’é™¤</p>
  </div>
  
  <div class="transform transition-all duration-300 hover:scale-105 text-center">
    <div class="text-6xl mb-4">ğŸ”’</div>
    <h2 class="text-3xl font-bold text-green-600">æ“ä½œã«å‰¯ä½œç”¨ã‚’å«ã¾ã›ãªã„</h2>
    <p class="text-xl text-gray-600 mt-2">ç´”ç²‹é–¢æ•°ã«ã‚ˆã‚‹äºˆæ¸¬å¯èƒ½ãªå‡¦ç†</p>
  </div>
</div>

---
layout: default
---

# æœ¬æ—¥ã®æµã‚Œ

<div class="grid grid-cols-2 grid-rows-2 gap-6 h-full">

<div class="px-4 py-3 rounded-lg border border-gray-200 h-40" style="background-color: #f1f5f9;">

## â‘  ğŸ—ï¸ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¡¨ç¾
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³  

</div>

<div class="px-4 py-3 rounded-lg border border-gray-200 h-40" style="background-color: #f1f5f9;">

## â‘¡ âš™ï¸  ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®è¡¨ç¾
- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®è¡¨ç¾
- å‰¯ä½œç”¨ã®æŠ½è±¡åŒ–

</div>

<div class="px-4 py-3 rounded-lg border border-gray-200 h-40" style="background-color: #f1f5f9;">

## â‘¢ ğŸŒ æŠ€è¡“å®Ÿè£…
- æ°¸ç¶šåŒ–
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº

</div>

<div class="px-4 py-3 rounded-lg border border-gray-200 h-40" style="background-color: #f1f5f9;">

## â‘£ ğŸ”— çµ±åˆ
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…ã®ç¹‹ãè¾¼ã¿
- Web API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹å®‰å…¨ãªå®šç¾©

</div>

</div>

<div class="text-center mt-6">

**ğŸ¯ ç›®æ¨™: å‹å®‰å…¨ãªè·å“¡ç®¡ç† API ã®å®Œæˆ**

</div>

---
layout: center
class: text-center
---

# Part 1
## ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨˜è¿°
å‹å®‰å…¨ãªãƒ‰ãƒ¡ã‚¤ãƒ³ã®å®šç¾©

<style>
  .slidev-layout {
    background: #1e293b;
  }
  h1, h2, p, ul, li {
    color: white;
  }
</style>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ¤œè¨: ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆè¦ç´ ã¯ã€ä¸»ã«ä»¥ä¸‹ã®3ã¤ã«åˆ†é¡ã§ãã¾ã™ã€‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | èª¬æ˜ |
|----------|------|
| **ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹** | åŸºæœ¬çš„ãªå€¤ã®è¡¨ç¾ |
| **ç›´ç©å‹** | è¤‡æ•°ã®å€¤ã‚’çµ„ã¿åˆã‚ã› |
| **ç›´å’Œå‹** | ã„ãã¤ã‹ã®é¸æŠè‚¢ã‹ã‚‰ä¸€ã¤ |

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ¤œè¨: ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…

Scalaã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã‚’ç”¨ã„ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ç›®çš„ | Scala ã§ã®ä¸»ãªå®Ÿè£…æ‰‹æ³• |
|----------|------|-------------------|
| **ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹** | å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åŸºæœ¬çš„ãªå€¤ã‚’è¡¨ç¾ | Opaque Types |
| **ç›´ç©å‹** | è¤‡æ•°ã®å€¤ã‚’çµ„ã¿åˆã‚ã›ã¦ä¸€ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¾ | case class, Tuple |
| **ç›´å’Œå‹** | ã„ãã¤ã‹ã®é¸æŠè‚¢ã‹ã‚‰ä¸€ã¤ã‚’è¡¨ç¾ | Enum, Union Types, Either |

---
layout: default
---

# ãƒ‘ã‚¿ãƒ¼ãƒ³: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹

<h2 class="text-2xl font-bold mb-6">Opaque Types ã«ã‚ˆã£ã¦ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹ã‚’è¡¨ç¾</h2>

<div class="grid grid-cols-2 gap-8">

<div>

```scala
opaque type GivenName = String
opaque type FamilyName = String

object GivenName:
  def apply(value: String): GivenName = value
object FamilyName:
  def apply(value: String): FamilyName = value

val givenName  = GivenName("å¤ªéƒ")
val familyName = FamilyName("å±±ç”°")

// å‹ã®æ··åŒã‚’é˜²ã - ã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
val invalidAssign: GivenName = familyName // âŒ
```

</div>

<div>

```mermaid
flowchart LR
    FamilyName["FamilyName"]
    GivenName["GivenName"]
    FamilyName -.->|"runtime"| Runtime1["String"]
    GivenName -.->|"runtime"| Runtime2["String"]
    
    style FamilyName fill:#fff3e0,stroke:#bf360c
    style GivenName fill:#fff3e0,stroke:#bf360c
    style Runtime1 fill:#f3e5f5,stroke:#4a148c
    style Runtime2 fill:#f3e5f5,stroke:#4a148c
```

<div class="p-4 rounded-lg border border-gray-200 mt-4" style="background-color: #f1f5f9;">
  <h4 class="text-base font-bold mb-3">ğŸ’¡ ç‰¹å¾´ãƒ»ãƒ¡ãƒªãƒƒãƒˆ</h4>
  <div class="space-y-2">
    <ul>
      <li class="text-xs">å®Ÿè¡Œæ™‚ã¯ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹ã¨è§£é‡ˆã•ã‚Œã‚‹ã€‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ã‚¹ãƒˆã‚¼ãƒ­</li>
      <li class="text-xs">å®šç¾©ã—ãŸã‚¹ã‚³ãƒ¼ãƒ—ä»¥å¤–ã§ã¯ç•°ãªã‚‹å‹ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹</li>
    </ul>
  </div>
</div>

</div>

</div>

---
layout: default
---

# ãƒ‘ã‚¿ãƒ¼ãƒ³: ç›´ç©å‹

<h2 class="text-2xl font-bold mb-6">case class ã‚’ç”¨ã„ã¦å€¤ã®çµ„ã¿åˆã‚ã›ã‚’è¡¨ç¾</h2>

<div class="grid grid-cols-2 gap-8">

<div>

```scala
case class Name(
  familyName: FamilyName,
  givenName:  Option[GivenName]
)

val name = Name(
  FamilyName("å±±ç”°"), 
  Some(GivenName("å¤ªéƒ"))
)

println(name)
// Name(å±±ç”°,Some(å¤ªéƒ))
```

</div>

<div>

```mermaid
flowchart TD
    Name["Name"]
    FamilyName["FamilyName"]
    GivenName["GivenName"]
    
    Name -->|"1"| FamilyName
    Name -->|"0..1"| GivenName
    
    FamilyName -.->|"runtime"| Runtime1["String"]
    GivenName -.->|"runtime"| Runtime2["String"]
    
    style Name fill:#e8f5e8,stroke:#2d5016,stroke-width:2px
    style FamilyName fill:#fff3e0,stroke:#bf360c
    style GivenName fill:#fff3e0,stroke:#bf360c
    style Runtime1 fill:#f3e5f5,stroke:#4a148c
    style Runtime2 fill:#f3e5f5,stroke:#4a148c
```

</div>

</div>

---
layout: default
---

# ãƒ‘ã‚¿ãƒ¼ãƒ³: ç›´å’Œå‹ (Enum)

<h2 class="text-2xl font-bold mb-6">Enum ã‚’ç”¨ã„ã¦é¸æŠè‚¢ã‚’è¡¨ç¾</h2>

<div class="grid grid-cols-2 gap-8">

<div>

```scala
enum Role:
  case Manager, Member

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãã§ã‚ˆã‚Šè©³ç´°ã«
enum DetailedRole(val displayName: String):
  case Manager extends DetailedRole("ç®¡ç†è€…")
  case Member  extends DetailedRole("ä¸€èˆ¬è·å“¡")

val role: Role = Role.Manager
val detailedRole = DetailedRole.Manager

println(detailedRole.displayName)
// "ç®¡ç†è€…"
```

</div>

<div>

```mermaid
graph BT
    B[Manager] --> A[Role]
    C[Member] --> A
    
    E["Manager<br/>(ç®¡ç†è€…)"] --> D[DetailedRole]
    F["Member<br/>(ä¸€èˆ¬è·å“¡)"] --> D
    
    style A fill:#fce4ec
    style D fill:#fce4ec
    style B fill:#e8f5e8
    style C fill:#e8f5e8
    style E fill:#e8f5e8
    style F fill:#e8f5e8
```

</div>

</div>

---
layout: default
---

# ãƒ‘ã‚¿ãƒ¼ãƒ³: ç›´å’Œå‹ (Union Types)

<h2 class="text-2xl font-bold mb-6">Union Types ã‚’ç”¨ã„ã¦ç•°ãªã‚‹å‹ã®é¸æŠè‚¢ã‚’è¡¨ç¾</h2>

<div class="grid grid-cols-2 gap-8">

<div>

```scala
// ãƒ­ã‚°ã‚¤ãƒ³IDã®ä¾‹
opaque type Username = String
opaque type EmailAddress = String
case class UsernameAndEmailAddress(
  username: Username, 
  email:    EmailAddress
)

type LoginId = Username
  | EmailAddress
  | UsernameAndEmailAddress

val loginWithUsername: LoginId = username
val loginWithEmail: LoginId = email
val loginWithBoth: LoginId = UsernameAndEmailAddress(username, email)
```

</div>

<div>

```mermaid
graph BT
    B[Username] --> A[LoginId]
    C[EmailAddress] --> A
    D[UsernameAndEmailAddress] --> A
    
    style A fill:#fff3e0
    style B fill:#e3f2fd
    style C fill:#e3f2fd
    style D fill:#e3f2fd
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ¤œè¨: è·å“¡

ä»¥ä¸‹ã®ã‚ˆã†ãªè·å“¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã™ã€‚

| é …ç›® | èª¬æ˜ |
|------|------|
| **ID** | è·å“¡ã¯ ID ã‚’æŒã¤ã€‚ID ã®å½¢å¼ã¯ UUIDv4 ã¨ã™ã‚‹ |
| **è·å“¡å** | å§“åã‚’æŒã¤ã€‚å§“åã®ã†ã¡ã€åã¯ä»»æ„ |
| **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹** | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ã€‚æœªæ¤œè¨¼ or æ¤œè¨¼æ¸ˆã¿ã®ç®¡ç†ãŒã•ã‚Œã‚‹ |
| **ãƒ­ãƒ¼ãƒ«** | ç®¡ç†è€… or ä¸€èˆ¬è·å“¡ |
| **ãƒ­ã‚°ã‚¤ãƒ³ID** | ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |

**ğŸ¯ ã“ã‚Œã‚‰ã®è¦ä»¶ã‚’å‹å®‰å…¨ã«è¡¨ç¾ã—ã¦ã„ãã¾ã—ã‚‡ã†**

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: è·å“¡ID

<div class="mb-4">
  <span class="text-xs bg-gray-700 text-white px-2 py-1 rounded-sm font-mono">è¦ä»¶</span>
  <span class="text-sm ml-2 italic text-gray-600">è·å“¡ã¯ ID ã‚’æŒã¤ã€‚ID ã®å½¢å¼ã¯ UUIDv4 ã¨ã™ã‚‹</span>
</div>

è·å“¡ ID ã‚’ Opaque Types ã§å®šç¾©ã—ã¾ã™ã€‚UUID ã®ç”Ÿæˆã¯å‰¯ä½œç”¨ã‚’ä¼´ã†ãŸã‚ã€ç”Ÿæˆã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã§è¡Œã„ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã§ã¯ ID ã®å‹ã®ã¿ã‚’å®šç¾©ã—ã¾ã™ã€‚

<div class="grid grid-cols-5 gap-8">

<div class="col-span-3">

```scala
// UUIDå‹ã‹ã‚‰IDã¸ã®å¤‰æ›ã‚’æä¾›ã™ã‚‹å‹ã‚¯ãƒ©ã‚¹
trait FromUUID[K]:
  def fromUUID(uuid: UUID): K

object FromUUID:
  def apply[K](using instance: FromUUID[K]): FromUUID[K] = instance

// Opaque Type ã«ã‚ˆã‚‹è·å“¡ ID ã®å®šç¾©
opaque type Id = UUID
object Id:
  def fromUUID(uuid: UUID): Id = uuid

  extension (id: Id) 
    def value: UUID = id

  given FromUUID[Id] = new FromUUID[Id]:
    def fromUUID(uuid: UUID): Id = Id.fromUUID(uuid)
```

</div>

<div class="col-span-2">

```mermaid
flowchart LR
    Id["Id"]
    
    Id -.->|"runtime"| Runtime["UUID"]
    
    style Id fill:#fff3e0,stroke:#bf360c
    style Runtime fill:#f3e5f5,stroke:#4a148c
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: è·å“¡å

<div class="mb-4">
  <span class="text-xs bg-gray-700 text-white px-2 py-1 rounded-sm font-mono">è¦ä»¶</span>
  <span class="text-sm ml-2 italic text-gray-600">è·å“¡åã‚’æŒã¤ã€‚å§“åã®ã†ã¡ã€åã¯ä»»æ„</span>
</div>

å§“åã‚’ãã‚Œãã‚Œå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¡¨ç¾ã—ã€ç›´ç©å‹ã§çµåˆã—ã¦è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

<div class="grid grid-cols-5 gap-8">

<div class="col-span-3">

```scala
// å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¡¨ç¾
opaque type GivenName = String
opaque type FamilyName = String
object GivenName:
  def apply(value: String): GivenName = value
object FamilyName:
  def apply(value: String): FamilyName = value

// å§“åã®çµ„ã¿åˆã‚ã›ã‚’ç›´ç©å‹ã§è¡¨ç¾ã€‚åã¯ä»»æ„ãªã®ã§ Option[_] å‹ã§åŒ…ã‚€
case class Name(
  familyName: FamilyName,
  givenName:  Option[GivenName]
)

val name = Name(FamilyName("å±±ç”°"), Some(GivenName("å¤ªéƒ")))

println(name)
// Name(å±±ç”°,Some(å¤ªéƒ))
```

</div>

<div class="col-span-2">

```mermaid
flowchart TD
    Name["Name"]
    FamilyName["FamilyName"]
    GivenName["GivenName"]
    
    Name -->|"1"| FamilyName
    Name -->|"0..1"| GivenName
    
    FamilyName -.->|"runtime"| Runtime1["String"]
    GivenName -.->|"runtime"| Runtime2["String"]
    
    style Name fill:#e8f5e8,stroke:#2d5016,stroke-width:2px
    style FamilyName fill:#fff3e0,stroke:#bf360c
    style GivenName fill:#fff3e0,stroke:#bf360c
    style Runtime1 fill:#f3e5f5,stroke:#4a148c
    style Runtime2 fill:#f3e5f5,stroke:#4a148c
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

<div class="mb-4">
  <span class="text-xs bg-gray-700 text-white px-2 py-1 rounded-sm font-mono">è¦ä»¶</span>
  <span class="text-sm ml-2 italic text-gray-600">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æœªæ¤œè¨¼ or æ¤œè¨¼æ¸ˆã¿ã®ç®¡ç†ãŒã•ã‚Œã‚‹</span>
</div>

ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ–‡å­—åˆ—ã€æ¤œè¨¼çŠ¶æ…‹ã‚’æŒã¤ç›´å’Œå‹ã‚’å®šç¾©ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®çŠ¶æ…‹ã‚’å‹ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

<div class="grid grid-cols-4 gap-8">

<div class="col-span-3">

```scala
sealed abstract class EmailAddress(value: String, val isValidated: Boolean)
case class UnvalidatedEmailAddress(value: String) extends EmailAddress(value, false):
  def toValidated: ValidatedEmailAddress = ValidatedEmailAddress(value)
case class ValidatedEmailAddress(value: String)   extends EmailAddress(value, true)

val unvalidatedEmail = UnvalidatedEmailAddress("taro.yamada@example.com")
val validatedEmail   = unvalidatedEmail.toValidated

println(unvalidatedEmail)
// UnvalidatedEmailAddress(taro.yamada@example.com)
println(unvalidatedEmail.isValidated)
// false

println(validatedEmail)
// ValidatedEmailAddress(taro.yamada@example.com)
println(validatedEmail.isValidated)
// true
```

</div>

<div class="col-span-1">

```mermaid
classDiagram
    class EmailAddress {
        <<abstract>>
        +String value
        +Boolean isValidated
    }
    class UnvalidatedEmailAddress {
        +String value
        +toValidated() ValidatedEmailAddress
    }
    class ValidatedEmailAddress {
        +String value
    }
    
    EmailAddress <|-- UnvalidatedEmailAddress
    EmailAddress <|-- ValidatedEmailAddress
    UnvalidatedEmailAddress ..> ValidatedEmailAddress : toValidated
    
    style EmailAddress fill:#fce4ec,stroke:#880e4f
    style UnvalidatedEmailAddress fill:#e8f5e8,stroke:#2d5016
    style ValidatedEmailAddress fill:#e8f5e8,stroke:#2d5016
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: ãƒ­ãƒ¼ãƒ«

<div class="mb-4">
  <span class="text-xs bg-gray-700 text-white px-2 py-1 rounded-sm font-mono">è¦ä»¶</span>
  <span class="text-sm ml-2 italic text-gray-600">ãƒ­ãƒ¼ãƒ«ã¯ç®¡ç†è€… or ä¸€èˆ¬è·å“¡</span>
</div>

ãƒ­ãƒ¼ãƒ«ã¯éšå±¤æ§‹é€ ã‚’æŒã£ãŸé¸æŠè‚¢ã®æ§‹é€ ãªã®ã§ã€Enum ã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã®ãŒé©åˆ‡ã§ã—ã‚‡ã†ã€‚sealed abstract class + case object, Union Types ã§ã‚‚è¡¨ç¾ã§ãã¾ã™ãŒã€ä»Šå›ã¯ Enum ã§å®šç¾©ã™ã‚‹ã®ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

<div class="grid grid-cols-5 gap-8">

<div class="col-span-3">

```scala
// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒã§ãã‚‹
enum Role(val value: String, val displayName: String):
  case Manager extends Role("manager", "ç®¡ç†è€…")
  case Member  extends Role("member", "ä¸€èˆ¬è·å“¡")

// Enum ã§å®šç¾©ã™ã‚‹ã¨ã€values ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ä¾¿åˆ©ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒç”Ÿãˆã¦ãã‚‹
Role.values.foreach: role =>
  println(s"${role} : ${role.value}, ${role.displayName}")
// Manager, manager, ç®¡ç†è€…
// Member, member, ä¸€èˆ¬è·å“¡
```

</div>

<div class="col-span-2">

```mermaid
flowchart BT
    Manager["ç®¡ç†è€…<br/>(Manager)"]
    Member["ä¸€èˆ¬è·å“¡<br/>(Member)"]
    Role["Role"]
    
    Manager --> Role
    Member --> Role
    
    style Role fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    style Manager fill:#e8f5e8,stroke:#2d5016
    style Member fill:#e8f5e8,stroke:#2d5016
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: ãƒ­ã‚°ã‚¤ãƒ³ID

<div class="mb-4">
  <span class="text-xs bg-gray-700 text-white px-2 py-1 rounded-sm font-mono">è¦ä»¶</span>
  <span class="text-sm ml-2 italic text-gray-600">ãƒ­ã‚°ã‚¤ãƒ³IDã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
</div>

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å®šç¾©ã—ã€ãƒ­ã‚°ã‚¤ãƒ³IDã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®çµ„ã¿åˆã‚ã›ã§è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<div class="grid grid-cols-5 gap-8">

<div class="col-span-3">

```scala
opaque type Username = String
object Username:
  def apply(value: String): Username = value

case class LoginId(username: Option[Username], email: EmailAddress)
```

</div>

<div class="col-span-2">

```mermaid
flowchart TD
    LoginId["LoginId"]
    Username["Username"]
    EmailAddress["EmailAddress"]
    
    LoginId -->|"0..1"| Username
    LoginId -->|"1"| EmailAddress
    
    Username -.->|"runtime"| RuntimeUsername["String"]
    
    style LoginId fill:#e8f5e8,stroke:#2d5016,stroke-width:2px
    style Username fill:#fff3e0,stroke:#bf360c
    style EmailAddress fill:#fff3e0,stroke:#bf360c
    style RuntimeUsername fill:#f3e5f5,stroke:#4a148c
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: ãƒ­ã‚°ã‚¤ãƒ³ID (Union Typesç‰ˆ)

Union Types ã‚’ä½¿ã£ã¦è¡¨ç¾ã™ã‚‹ã¨èµ·ãã†ã‚‹çŠ¶æ…‹ã‚’æ˜ç¢ºã«è¡¨ç¾ã§ãã¾ã™ã€‚

<div class="grid grid-cols-5 gap-8">

<div class="col-span-3">

```scala
case class UsernameAndEmailAddress(
  username: Username,
  email:    EmailAddress
)
// ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã€ã¾ãŸã¯ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹&ãƒ¦ãƒ¼ã‚¶ãƒ¼åã©ã¡ã‚‰ã‚‚åˆ©ç”¨å¯èƒ½ã€ã‚’è¡¨ç¾
// Username å˜ä½“ã®çŠ¶æ…‹ãŒã‚ã‚‹ã¨ã€Union Types ã®æ–¹ãŒè¡¨ç¾ã—ã‚„ã™ããªã‚‹
type LoginId = EmailAddress | UsernameAndEmailAddress

val email = UnvalidatedEmailAddress("taro.yamada@example.com")
val username = Username("tyamada")

val loginId1: LoginId = UsernameAndEmailAddress(username, email)
val loginId2: LoginId = email
println(loginId1)
// UsernameAndEmailAddress(tyamada,UnvalidatedEmailAddress(taro.yamada@example.com))
println(loginId2)
// UnvalidatedEmailAddress(taro.yamada@example.com)
```

</div>

<div class="col-span-2">

```mermaid
flowchart BT
    EmailAddress["EmailAddress"]
    UsernameAndEmailAddress["UsernameAndEmailAddress"]
    LoginId["LoginId"]

    EmailAddress --> LoginId
    UsernameAndEmailAddress --> LoginId
    
    style LoginId fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    style EmailAddress fill:#e8f5e8,stroke:#2d5016
    style UsernameAndEmailAddress fill:#e8f5e8,stroke:#2d5016
```

```mermaid
flowchart TD
    UsernameAndEmailAddress["UsernameAndEmailAddress"]
    Username["Username"]
    EmailAddress["EmailAddress"]
    
    UsernameAndEmailAddress --> Username
    UsernameAndEmailAddress --> EmailAddress
    
    style UsernameAndEmailAddress fill:#e8f5e8,stroke:#2d5016
    style Username fill:#fff3e0,stroke:#bf360c
    style EmailAddress fill:#fff3e0,stroke:#bf360c
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…: è·å“¡

ã“ã‚Œã¾ã§ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã€Staff ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

<div class="grid grid-cols-2 gap-8">

<div>

```scala
case class Staff(
  id:       Staff.Id,
  name:     Staff.Name,
  username: Option[Staff.Username],
  email:    Staff.EmailAddress,
  role:     Staff.Role
):
  val loginId: Staff.LoginId = username match
    case Some(username) => Staff.UsernameAndEmailAddress(username, email)
    case None           => email

def create(id: Id, name: Name, email: EmailAddress, role: Role, username: Option[Username]): Staff =
  Staff(
    id       = id,
    name     = name,
    username = username,
    email    = email,
    role     = role
  )
```

</div>

<div>

```mermaid
flowchart LR
    Staff["è·å“¡<br/>(Staff)"]
    Id["Id"]
    Name["Name"]
    Username["Username"]
    EmailAddress["EmailAddress"]
    Role["Role"]
    
    Staff -->|"1"| Id
    Staff -->|"1"| Name
    Staff -->|"0..1"| Username
    Staff -->|"1"| EmailAddress
    Staff -->|"1"| Role
    
    Name -.-> FG["FamilyName (1)<br/>GivenName (0..1)"]
    EmailAddress -.-> EA["Unvalidated<br/>or<br/>Validated"]
    Role -.-> RM["ç®¡ç†è€… / ä¸€èˆ¬è·å“¡"]
    
    style Staff fill:#e8f5e8,stroke:#2d5016,stroke-width:3px
    style Id fill:#fff3e0,stroke:#bf360c
    style Name fill:#e8f5e8,stroke:#2d5016
    style Username fill:#fff3e0,stroke:#bf360c
    style EmailAddress fill:#fce4ec,stroke:#880e4f
    style Role fill:#fce4ec,stroke:#880e4f
    style FG fill:#fff3e0,stroke:#bf360c
    style EA fill:#e8f5e8,stroke:#2d5016
    style RM fill:#e8f5e8,stroke:#2d5016
```

</div>

</div>

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

ã„ã¾ã®å®Ÿè£…ã§ã¯ã€åå‰ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä¸æ­£ãªå€¤ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```scala
// OK
val invalidEmail = EmailAddress("invalid-email")

// OK
val emptyName = GivenName("")
val invalidName = GivenName("ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰ã¨ã¦ã‚‚é•·ã„åå‰")
```

å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ãŸæ™‚ç‚¹ã§ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã®åˆ¶ç´„ã¯æº€ãŸã™ã‚ˆã†ã«ã—ãŸã„ã§ã™ã€‚

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

è·å“¡ãƒ¢ãƒ‡ãƒ«ã®è¦ä»¶ã«ã€ä»¥ä¸‹ã®åˆ¶ç´„ã‚’è¿½åŠ ã—ã¾ã™ã€‚

| é …ç›® | åˆ¶ç´„ |
|------|------|
| **è·å“¡å** | å§“åãã‚Œãã‚Œ1æ–‡å­—ä»¥ä¸Š32æ–‡å­—ä»¥ä¸‹ |
| **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹** | [WHATWG](https://html.spec.whatwg.org/multipage/input.html#valid-e-mail-address) ã§å®šç¾©ã•ã‚ŒãŸæ­£è¦è¡¨ç¾ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼å** | 4æ–‡å­—ä»¥ä¸Š16æ–‡å­—ä»¥ä¸‹ |

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ä»¥ä¸‹ã®2ã¤ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆæ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã€ä¸æ­£ãªå€¤ã®ç”Ÿæˆã‚’é˜²ã
- Refinement Types
  - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆ¶ç´„ã‚’å‹ã§è¡¨ç¾ã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¸æ­£ãªå€¤ã‚’æ’é™¤ã™ã‚‹

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

<div class="smart-constructor">
<p class="description">ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”¨ã„ã¦ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆæ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã€ä¸æ­£ãªå€¤ã®ç”Ÿæˆã‚’é˜²ãã¾ã™ã€‚</p>

<div class="implementation-example">
<div class="code-part">
<h4>å®Ÿè£…</h4>

```scala
object GivenName:
  def apply(value: String): Either[String, GivenName] =
    if value.isEmpty then 
      Left("GivenName must not be empty.")
    else if value.length > 32 then 
      Left("GivenName must be less than or equal to 32.")
    else 
      Right(value)
```
</div>

<div class="example-part">
<h4>ä½¿ç”¨ä¾‹ã¨çµæœ</h4>

```scala
val valid    = GivenName("å¤ªéƒ")
val invalid1 = GivenName("")
val invalid2 = GivenName("ã‚" * 33)
```

<div class="validation-results">
<div class="result ok">âœ… <code>valid</code> â†’ <code>Right(å¤ªéƒ)</code></div>
<div class="result ng">âŒ <code>invalid1</code> â†’ <code>Left("GivenName must not be empty.")</code></div>
<div class="result ng">âŒ <code>invalid2</code> â†’ <code>Left("GivenName must be less than or equal to 32.")</code></div>
</div>
</div>
</div>
</div>

<style>
.smart-constructor .description {
  color: #475569;
  margin-bottom: 1.5rem;
}

.implementation-example {
  display: grid;
  grid-template-columns: 1fr 1.1fr;
  gap: 2rem;
}

.code-part h4, .example-part h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
}

.code-part pre, .example-part pre {
  font-size: 0.85rem;
  line-height: 1.5;
}

.validation-results {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 1rem;
  margin-top: 1rem;
}

.validation-results .result {
  padding: 0.4rem 0;
  font-size: 0.85rem;
  display: flex;
  align-items: start;
  gap: 0.5rem;
}

.result.ok {
  color: #059669;
}

.result.ng {
  color: #dc2626;
}

.result code {
  background: #e5e7eb;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  font-size: 0.8rem;
}
</style>

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

<div class="validation-example">
<p class="description">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åãªã©ã‚‚åŒæ§˜ã«ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”¨ã„ã¦å®Ÿè£…ã§ãã¾ã™ã€‚</p>

<div class="code-with-result">
<div class="code-section">
```scala
object EmailAddress:
  val EMAIL_REGEXP = """^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$""".r

  def apply(value: String): Either[String, EmailAddress] =
    if EMAIL_REGEXP.matches(value) then 
      Right(UnvalidatedEmailAddress(value))
    else 
      Left("Invalid email address.")
```
</div>

<div class="example-section">
<h4>å®Ÿè¡Œä¾‹</h4>

```scala
val valid   = EmailAddress("taro.yamada@example.com")
val invalid1 = EmailAddress("taro.yamada@@example.com")
val invalid2 = EmailAddress("taro.yamadaxample.com")
```

<div class="results">
<div class="result-item success">
âœ… <code>valid</code> â†’ <code>Right(UnvalidatedEmailAddress(...))</code>
</div>
<div class="result-item error">
âŒ <code>invalid1</code> â†’ <code>Left("Invalid email address.")</code>
</div>
<div class="result-item error">
âŒ <code>invalid2</code> â†’ <code>Left("Invalid email address.")</code>
</div>
</div>
</div>
</div>
</div>

<style>
.validation-example .description {
  color: #475569;
  margin-bottom: 1.5rem;
}

.code-with-result {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 2rem;
}

.code-section pre {
  font-size: 0.85rem;
  line-height: 1.4;
}

.example-section h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.example-section pre {
  font-size: 0.85rem;
  margin-bottom: 1rem;
}

.results {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 1rem;
}

.result-item {
  padding: 0.5rem 0;
  font-size: 0.85rem;
  border-bottom: 1px solid #e2e8f0;
}

.result-item:last-child {
  border-bottom: none;
}

.result-item.success {
  color: #059669;
}

.result-item.error {
  color: #dc2626;
}

.result-item code {
  background: #e5e7eb;
  padding: 0.125rem 0.25rem;
  border-radius: 3px;
  font-size: 0.8rem;
}
</style>

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯åå‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã»ã¼åŒã˜ã§ã™ã€‚

```scala
object Username:
  def apply(value: String): Either[String, Username] =
    if value.length < 4 then Left("Username must be at least 4 characters long.")
    else if value.length > 16 then Left("Username must be less than or equal to 16 characters long.")
    else Right(value)
```

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: Refinement Types

Refinement Types ã‚’ç”¨ã„ã‚‹ã¨ã€å‹è‡ªä½“ã«åˆ¶ç´„ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»Šå›ã¯ [iron](https://github.com/Iltotore/iron) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```scala
type GivenName = GivenName.T
object GivenName extends RefinedType[String, MinLength[1] & MaxLength[32]]

val refinedGivenName = GivenName.either("å¤ªéƒ")
val refinedInvalidGivenName1 = GivenName.either("")
val refinedInvalidGivenName2 = GivenName.either("ã‚" * 33) // 32æ–‡å­—ã‚’è¶…ãˆã‚‹

println(refinedGivenName)
// Right(å¤ªéƒ)
println(refinedInvalidGivenName1)
// Left(Should have a minimum length of 1 & Should have a maximum length of 32)
println(refinedInvalidGivenName2)
// Left(Should have a minimum length of 1 & Should have a maximum length of 32)

// ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚‚åŒæ§˜ã«å®šç¾©
type Username = Username.T
object Username extends RefinedType[String, MinLength[4] & MaxLength[16]]
```

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: Refinement Types

åˆ¶ç´„ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```scala
final class EmailConstraint
object EmailConstraint:
  val EMAIL_REGEXP = """^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$""".r
  given Constraint[String, EmailConstraint] with
    override inline def test(inline value: String): Boolean = EMAIL_REGEXP.matches(value)
    override inline def message: String = "Should be valid email address."

type Email = Email.T
object Email extends RefinedType[String, EmailConstraint]
```

---
layout: default
---

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: Refinement Types

Email å‹ã‚’ä½¿ã£ã¦ EmailAddress ã®å®šç¾©ã‚’æ›´æ–°ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```scala
sealed abstract class EmailAddress(val value: Email, val isValidated: Boolean)
object EmailAddress:
  case class Unvalidated(override val value: Email) extends EmailAddress(value, false)
  case class Validated(override val value: Email)   extends EmailAddress(value, true)
  def either(email: String): Either[String, EmailAddress] = Email.either(email).map(Unvalidated(_))

val validEmailAddress = EmailAddress.either("taro.yamada@example.com")
val invalidEmailAddress1 = EmailAddress.either("taro.yamada@@example.com")
val invalidEmailAddress2 = EmailAddress.either("taro.yamadaxample.com")

println(validEmailAddress)
// Right(Unvalidated(taro.yamada@example.com))
println(invalidEmailAddress1)
// Left(Should be valid email address.)
println(invalidEmailAddress2)
// Left(Should be valid email address.)
```

---
layout: default
---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«: è·å“¡ãƒ¢ãƒ‡ãƒ«ã®å‹å®‰å…¨ãªç”Ÿæˆ

<div class="factory-methods">
<p class="description">å„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ã§ã€è·å“¡ãƒ¢ãƒ‡ãƒ«ã®ç”Ÿæˆæ™‚ã«ä¸æ­£ãªå€¤ãŒå…¥ã‚‹ã“ã¨ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>

```scala
def create(
  id:    Id, 
  name:  Name, 
  email: EmailAddress, 
  role:  Role 
): Staff =
  Staff(
    id       = id,
    name     = name,
    username = None,
    email    = email,
    role     = role
  )
```
</div>

<style>
.factory-methods .description {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
}
</style>

---
layout: center
class: text-center
---

# Part 2
## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®è¨˜è¿°
å‰¯ä½œç”¨ã‚’æŠ½è±¡åŒ–ã—ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®è¨˜è¿°ã«é›†ä¸­ã™ã‚‹

<style>
  .slidev-layout {
    background: #1e293b;
  }
  h1, h2, p, ul, li {
    color: white;
  }
</style>

---
layout: default
---

# é¡Œæ: è·å“¡ã‚’ä½œæˆã™ã‚‹

ä»¥ä¸‹ã®ã‚ˆã†ãªã€Œè·å“¡ã‚’ä½œæˆã™ã‚‹ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¾ã™ã€‚ã“ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ã„ãã¤ã‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†è§£ã§ãã¾ã™ã€‚

<div class="workflow-container">
  <div class="workflow-step">
    <div class="step-number">1</div>
    <div class="step-content">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯</div>
  </div>
  <div class="workflow-arrow">â†“</div>
  <div class="workflow-step">
    <div class="step-number">2</div>
    <div class="step-content">è·å“¡ã®ä½œæˆ</div>
  </div>
  <div class="workflow-arrow">â†“</div>
  <div class="workflow-step">
    <div class="step-number">3</div>
    <div class="step-content">è·å“¡ã®æ°¸ç¶šåŒ–</div>
  </div>
  <div class="workflow-arrow">â†“</div>
  <div class="workflow-step">
    <div class="step-number">4</div>
    <div class="step-content">ã‚µãƒ¼ãƒ“ã‚¹é€£æº (ä½œæˆã‚¤ãƒ™ãƒ³ãƒˆç™ºç«)</div>
  </div>
</div>

<style>
.workflow-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 1rem 0;
  gap: 0.25rem;
}

.workflow-step {
  display: flex;
  align-items: center;
  background: #f3f4f6;
  border: 2px solid #e5e7eb;
  border-radius: 6px;
  padding: 0.75rem 1.5rem;
  width: 85%;
  max-width: 550px;
  transition: all 0.2s;
}

.workflow-step:hover {
  background: #e5e7eb;
  border-color: #d1d5db;
  transform: translateX(5px);
}

.step-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 1.75rem;
  height: 1.75rem;
  background: #3b82f6;
  color: white;
  border-radius: 50%;
  font-weight: bold;
  font-size: 0.9rem;
  margin-right: 1rem;
  flex-shrink: 0;
}

.step-content {
  font-size: 1rem;
  color: #374151;
  line-height: 1.3;
}

.workflow-arrow {
  font-size: 1.2rem;
  color: #3b82f6;
  font-weight: bold;
  line-height: 0.8;
  margin: -0.1rem 0;
}
</style>

---
layout: default
---

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®åˆ†è§£ (1/3)

<div class="type-signature-list">
  <div class="type-signature-item-wrapper">
    <div class="type-signature-item">
      <span class="step-num">1</span>
      <div class="content">
        <div class="label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯</div>
        <span class="io-badge">DBèª­ã¿è¾¼ã¿</span>
      </div>
    </div>
    <div v-click class="sub-steps">
      <div class="sub-step">
        <div>â€¢ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œç´¢</div>
        <pre><code>def findByEmail: EmailAddress => F[Option[Staff]]</code></pre>
      </div>
      <div class="sub-step">
        <div>â€¢ å­˜åœ¨ãƒã‚§ãƒƒã‚¯</div>
        <pre><code>def checkExists: Option[Staff] => Either[CreateStaffError, Unit]</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
.type-signature-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin: 1.5rem 0;
}

.type-signature-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.step-num {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: #3b82f6;
  color: white;
  border-radius: 50%;
  font-weight: bold;
  flex-shrink: 0;
}

.type-signature-item .content {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.type-signature-item .label {
  font-weight: 500;
  color: #1e293b;
  min-width: 200px;
}

.io-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  background: #fee2e2;
  color: #dc2626;
  margin-left: 0 !important;
}

.type-signature-item-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.sub-steps {
  margin-top: 0.5rem;
  padding-left: 3rem;
  font-size: 0.9rem;
}

.sub-step {
  margin: 0.75rem 0;
  color: #475569;
  line-height: 1.6;
}

.sub-step pre {
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 0.5rem 1rem;
  margin-top: 0.5rem;
  overflow-x: auto;
}

.sub-step pre code {
  background: transparent;
  padding: 0;
  border-radius: 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: #1e293b;
}
</style>

---
layout: default
---

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®åˆ†è§£ (2/3)

<div class="type-signature-list">
  <div class="type-signature-item-wrapper">
    <div class="type-signature-item">
      <span class="step-num">2</span>
      <div class="content">
        <div class="label">è·å“¡ã®ä½œæˆ</div>
        <span class="io-badge">IDç”Ÿæˆï¼ˆUUIDï¼‰</span>
      </div>
    </div>
    <div v-click class="sub-steps">
      <div class="sub-step">
        <div>â€¢ IDç™ºè¡Œ</div>
        <pre><code>def generateId: => F[Id]</code></pre>
      </div>
      <div class="sub-step">
        <div>â€¢ è·å“¡ä½œæˆ</div>
        <pre><code>def createStaff: CreateStaffRequest => Id => Staff</code></pre>
      </div>
    </div>
  </div>

  <div class="type-signature-item-wrapper">
    <div class="type-signature-item">
      <span class="step-num">3</span>
      <div class="content">
        <div class="label">è·å“¡ã®æ°¸ç¶šåŒ–</div>
        <span class="io-badge">DBæ›¸ãè¾¼ã¿</span>
      </div>
    </div>
    <div v-click class="sub-steps">
      <div class="sub-step">
        <pre><code>def save: Staff => F[Staff]</code></pre>
      </div>
    </div>
  </div>

</div>

<style>
.type-signature-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin: 1.5rem 0;
}

.type-signature-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.step-num {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: #3b82f6;
  color: white;
  border-radius: 50%;
  font-weight: bold;
  flex-shrink: 0;
}

.type-signature-item .content {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.type-signature-item .label {
  font-weight: 500;
  color: #1e293b;
  min-width: 200px;
}

.io-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  background: #fee2e2;
  color: #dc2626;
  margin-left: 0 !important;
}

.badge-group {
  display: flex;
  gap: 16px;
  margin-left: auto;
}

.type-signature-item .content > .io-badge {
  margin-left: auto !important;
}

.type-signature-item-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.sub-steps {
  margin-top: 1rem;
  padding-left: 3rem;
}

.sub-step {
  margin: 0.75rem 0;
  color: #475569;
  line-height: 1.6;
}

.sub-step pre {
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 0.5rem 1rem;
  margin-top: 0.5rem;
  overflow-x: auto;
}

.sub-step pre code {
  background: transparent;
  padding: 0;
  border-radius: 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: #1e293b;
}
</style>

---
layout: default
---

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®åˆ†è§£ (3/3)

<div class="type-signature-list">
  <div class="type-signature-item-wrapper">
    <div class="type-signature-item">
      <span class="step-num">4</span>
      <div class="content">
        <div class="label">ã‚µãƒ¼ãƒ“ã‚¹é€£æº (ä½œæˆã‚¤ãƒ™ãƒ³ãƒˆç™ºç«)</div>
        <div class="badge-group">
          <span class="io-badge">ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆ</span>
          <span class="io-badge">å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº</span>
        </div>
      </div>
    </div>
    <div v-click class="sub-steps">
      <div class="sub-step">
        <div>â€¢ ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ (æ—¥ä»˜ç”Ÿæˆ)</div>
        <pre><code>def createEvent: Staff => F[Instant] => F[StaffEvent]</code></pre>
      </div>
      <div class="sub-step">
        <div>â€¢ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«</div>
        <pre><code>def publishEvent: StaffEvent => F[Unit]</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
.type-signature-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin: 1.5rem 0;
}

.type-signature-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.step-num {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: #3b82f6;
  color: white;
  border-radius: 50%;
  font-weight: bold;
  flex-shrink: 0;
}

.type-signature-item .content {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.type-signature-item .label {
  font-weight: 500;
  color: #1e293b;
  min-width: 200px;
}

.type-signature-item code {
  background: #e5e7eb;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.9rem;
}

.io-badge, .pure-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: auto;
}

.io-badge {
  background: #fee2e2;
  color: #dc2626;
}

.pure-badge {
  background: #d1fae5;
  color: #059669;
}

.badge-group {
  display: flex;
  gap: 16px;
  margin-left: auto;
}

.type-signature-item-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.sub-steps {
  margin-top: 0.5rem;
  padding-left: 3rem;
  font-size: 0.9rem;
}

.sub-step {
  margin: 0.75rem 0;
  color: #475569;
  line-height: 1.6;
}

.sub-step pre {
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 0.5rem 1rem;
  margin-top: 0.5rem;
  overflow-x: auto;
}

.sub-step pre code {
  background: transparent;
  padding: 0;
  border-radius: 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: #1e293b;
}
</style>

---
layout: default
---

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å‰¯ä½œç”¨ã®æŠ½è±¡åŒ–

`F[_]` ã¨ã„ã†å½¢ã§æŠ½è±¡åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹è¨­è¨ˆæ™‚ã«å®Ÿè£…ã‚’æ„è­˜ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã€ãƒ†ã‚¹ãƒˆã§å®Ÿè£…ã‚’åˆ‡ã‚Šæ›¿ãˆã‚„ã™ããªã‚Šã¾ã™ã€‚

```scala
// è·å“¡æƒ…å ±ã®ãƒªãƒã‚¸ãƒˆãƒª
trait StaffRepository[F[_]]:
  def findByEmail(email: Staff.EmailAddress): F[Option[Staff]]
  def save(staff:        Staff):              F[Staff]

// ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
trait EventPublisher[F[_]]:
  def publish[E <: Event](event: E): F[Unit]

// ID ç”Ÿæˆå™¨
trait IdGenerator[F[_]]:
  def generate[K: FromUUID]: F[K]

// æ™‚åˆ»å–å¾—
trait TimeProvider[F[_]]:
  def now: F[Instant]

// ä¸Šè¨˜ã‚’çµ„ã¿åˆã‚ã›ã¦å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
trait CreateStaffService[F[_]]:
  def create(command: CreateStaffCommand): F[Either[CreateStaffError, CreateStaffEvent]]
```

---
layout: default
---

# CreateStaffService ã®å®Ÿè£…ï¼ˆ1/2ï¼‰

```scala
class CreateStaffServiceImpl[F[_]: Sync](
  staffRepository: StaffRepository[F],
  eventPublisher:  EventPublisher[F],
  idGenerator:     IdGenerator[F],
  timeProvider:    TimeProvider[F]
) extends CreateStaffService[F]:

  def create(command: CreateStaffCommand): F[Either[CreateStaffError, CreateStaffEvent]] =
    
    val process = for
      // 1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
      existingStaff <- EitherT.liftF(
        staffRepository.findByEmail(command.email)
      )
      _ <- EitherT.cond[F](
        existingStaff.isEmpty,
        (),
        CreateStaffError.EmailAlreadyExists(command.email)
      )
```

---
layout: default
---

# CreateStaffService ã®å®Ÿè£…ï¼ˆ2/2ï¼‰

```scala
      // 2. è·å“¡ã®ä½œæˆ
      staffId <- EitherT.liftF(idGenerator.generate[Staff.Id])
      newStaff = Staff.create(
        id    = staffId,
        name  = command.name,
        email = command.email,
        role  = command.role,
      )

      // 3. è·å“¡æƒ…å ±ã®æ°¸ç¶šåŒ–
      savedStaff <- EitherT.liftF(staffRepository.save(newStaff))

      // 4. ã‚¤ãƒ™ãƒ³ãƒˆã®ä½œæˆã¨ç™ºè¡Œ
      now <- EitherT.liftF(timeProvider.now)
      event = StaffCreatedEvent(data = savedStaff, occurredAt = now)
      _ <- EitherT.liftF(eventPublisher.publish(event))
    yield event

    process.value.handleError { throwable => 
      CreateStaffError.Unexpected(throwable).asLeft
    }
```

---
layout: default
---

# ç•°ãªã‚‹å®Ÿè£…ã®æä¾›

<div class="test-implementation">
<p class="description">ãƒ†ã‚¹ãƒˆã§ã¯ DBIO ã‚’èµ°ã‚‰ã›ãŸããªã„ãƒ»ãƒ¢ãƒƒã‚¯ã‚’è¡Œã„ãŸããªã„å ´åˆã€ç•°ãªã‚‹å®Ÿè£… (ä¾‹: ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã€å›ºå®šå€¤) ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<div class="code-sections">
<div class="code-section">
<h4>ãƒ†ã‚¹ãƒˆç”¨ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹</h4>

```scala
// ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§ã®å®Ÿè£…...
class InMemoryStaffRepository[F[_]: Sync] extends StaffRepository[F]: ...
class InMemoryEventPublisher[F[_]: Sync] extends EventPublisher[F]: ...

object IdGenerator:
  def uuid[F[_]: Sync]: IdGenerator[F] = new IdGenerator[F]:
    def generate[K: FromUUID]: F[K] = // UUIDç”Ÿæˆ...

  def fixed[F[_]: Sync](id: String): IdGenerator[F] = new IdGenerator[F]:
    def generate[K: FromUUID]: F[K] = // å›ºå®šå€¤ã‚’è¿”ã™...

object TimeProvider:
  def system[F[_]: Sync]: TimeProvider[F] = new TimeProvider[F]:
    def now: F[Instant] = // ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—...

  def fixed[F[_]: Sync](instant: Instant): TimeProvider[F] = new TimeProvider[F]:
    def now: F[Instant] = Sync[F].pure(instant)
```
</div>

<div class="code-section">
<h4>ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®çµ„ã¿ç«‹ã¦</h4>

```scala
val testTime = Instant.parse("2025-01-01T00:00:00Z")

val staffRepository = new InMemoryStaffRepository[IO]
val eventPublisher  = new InMemoryEventPublisher[IO]
val idGenerator     = IdGenerator.uuid[IO]
val timeProvider    = TimeProvider.fixed[IO](testTime)

val createStaffService = new CreateStaffServiceImpl[IO](
  staffRepository,
  eventPublisher,
  idGenerator,
  timeProvider
)
```
</div>
</div>
</div>

<style>
.test-implementation .description {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
}

.code-sections {
  display: flex;
  gap: 1rem;
  margin: 0 -1rem;
}

.code-section {
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.code-section h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.code-section pre {
  font-size: 0.8rem;
  line-height: 1.3;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  overflow-x: auto;
}
</style>

---
layout: default
---

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å‰¯ä½œç”¨ã®æŠ½è±¡åŒ–

<div class="pros-cons">
<div class="pros">
<h3>ğŸ‘ ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ul>
  <li>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…ãŒå‹å®‰å…¨ã«è¨˜è¿°ã§ãã‚‹</li>
  <li>å‰¯ä½œç”¨ã‚’æŠ½è±¡åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚‹</li>
  <li>å®Ÿè£…ã®åˆ‡ã‚Šæ›¿ãˆãŒå®¹æ˜“ (IO, Test, InMemory ãªã©)</li>
</ul>
</div>

<div class="cons">
<h3>ğŸ‘ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ul>
  <li>å®Ÿè£…ã®è¤‡é›‘åŒ– (ç‰¹ã«é«˜éšé–¢æ•°ã®ä½¿ç”¨)</li>
  <li>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾å­˜é–¢ä¿‚ãŒå¢—ãˆã‚‹</li>
</ul>
</div>
</div>

<style>
.pros-cons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

.pros, .cons {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 1.5rem;
}

.pros h3 {
  color: #059669;
  font-size: 1.2rem;
  margin-bottom: 1rem;
}

.cons h3 {
  color: #dc2626;
  font-size: 1.2rem;
  margin-bottom: 1rem;
}

.pros ul, .cons ul {
  list-style: none;
  padding-left: 0;
}

.pros li, .cons li {
  padding-left: 1.5rem;
  position: relative;
  margin-bottom: 0.5rem;
  line-height: 1.6;
}

.pros li:before {
  content: "âœ“";
  position: absolute;
  left: 0;
  color: #059669;
  font-weight: bold;
}

.cons li:before {
  content: "Ã—";
  position: absolute;
  left: 0;
  color: #dc2626;
  font-weight: bold;
}
</style>

---
layout: center
class: text-center
---

# Part 3
## ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®è¨˜è¿°
å®Ÿè£…ã®æä¾›

<style>
  .slidev-layout {
    background: #1e293b;
  }
  h1, h2, p {
    color: white;
  }
</style>

---
layout: default
---

# ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼šDBIO, å¤–éƒ¨é€£æºã«ä¾å­˜ã™ã‚‹éƒ¨åˆ†ã‚’å®Ÿè£…

<div class="infra-mapping">
<p class="description">ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã§å®šç¾©ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å…·ä½“çš„ãªæŠ€è¡“ã§å®Ÿè£…</p>

<div class="interface-impl-list">
  <div class="interface-impl-item">
    <div class="interface-box">
      <span class="label">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</span>
      <code>StaffRepository[F]</code>
    </div>
    <div class="arrow">â†’</div>
    <div class="impl-box">
      <span class="label">å®Ÿè£…</span>
      <code>StaffRepositoryDoobie[F]</code>
      <span class="tech">doobie, SQL</span>
    </div>
  </div>

  <div class="interface-impl-item">
    <div class="interface-box">
      <span class="label">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</span>
      <code>EventPublisher[F]</code>
    </div>
    <div class="arrow">â†’</div>
    <div class="impl-box">
      <span class="label">å®Ÿè£…</span>
      <code>AwsSnsEventPublisher[F]</code>
      <span class="tech">AWS SNS</span>
    </div>
  </div>
</div>
</div>

<style>
.infra-mapping .description {
  color: #475569;
  margin-bottom: 2rem;
  font-size: 1.1rem;
}

.interface-impl-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.interface-impl-item {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.interface-box, .impl-box {
  padding: 1rem 1.5rem;
  border-radius: 8px;
  flex: 1;
}

.interface-box {
  background: #e0e7ff;
  border: 2px solid #6366f1;
}

.impl-box {
  background: #f0fdf4;
  border: 2px solid #22c55e;
}

.interface-box .label, .impl-box .label {
  display: block;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.interface-box .label {
  color: #4338ca;
}

.impl-box .label {
  color: #16a34a;
}

.interface-box code, .impl-box code {
  display: block;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.impl-box .tech {
  display: block;
  font-size: 0.85rem;
  color: #64748b;
  margin-top: 0.5rem;
}

.arrow {
  font-size: 1.5rem;
  color: #94a3b8;
  flex-shrink: 0;
}

.infra-overview .description {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
}

.concept-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.concept {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 1.5rem;
}

.concept h4 {
  color: #1e293b;
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

.concept ul {
  list-style: none;
  padding-left: 0;
}

.concept li {
  padding: 0.5rem 0;
  color: #64748b;
  padding-left: 1.5rem;
  position: relative;
}

.concept li:before {
  content: "â€¢";
  position: absolute;
  left: 0;
  color: #94a3b8;
}
</style>

---
layout: default
---

# StaffRepository: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…

<div class="repository-comparison">
<p class="description">ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã§å®šç¾©ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã§å®Ÿè£…</p>

<div class="comparison-sections">
<div class="section">
<h4>ğŸ¯ StaffRepository</h4>

```scala
trait StaffRepository[F[_]]:
  def findById(id: Staff.Id): F[Option[Staff]]
  def findByEmail(email: Staff.EmailAddress): F[Option[Staff]]
  def save(staff: Staff): F[Staff]
  def delete(id: Staff.Id): F[Unit]
```

</div>

<div class="section">
<h4>ğŸ”§ StaffRepositoryImpl</h4>

```scala
class StaffRepositoryImpl(transactor: Transactor[IO]) 
  extends StaffRepository[IO]:
  
  def findByEmail(email: Staff.EmailAddress): IO[Option[Staff]] =
    sql"""
      SELECT BIN_TO_UUID(id), family_name, given_name, 
             email, email_validated, role, username
      FROM staffs
      WHERE email = ${email.value}
    """.query[(Staff.Id, Staff.FamilyName, 
               Option[Staff.GivenName], Staff.Email, 
               Boolean, Staff.Role, Option[Staff.Username])]
      .map { case (id, familyName, givenName, emailValue, 
                   isValidated, role, username) =>
        Staff.create(id, Staff.Name(familyName, givenName),
                     Staff.EmailAddress(emailValue, isValidated),
                     role, username)
      }.option.transact(transactor)
```

</div>
</div>
</div>

<style>
.repository-comparison .description {
  color: #475569;
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.comparison-sections {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  max-width: 100%;
}

.comparison-sections .section {
  background: #f8fafc;
  padding: 0.75rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  overflow: hidden;
}

.comparison-sections .section h4 {
  color: #1e293b;
  font-size: 0.9rem;
  margin-bottom: 0.75rem;
}

.comparison-sections .section pre {
  font-size: 0.65rem;
  line-height: 1.3;
  overflow-x: auto;
}

.comparison-sections .section .note {
  margin-top: 1rem;
  font-size: 0.85rem;
  color: #64748b;
}
</style>

---
layout: default
---

# StaffRepository: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ°¸ç¶šåŒ–

<div class="model-schema-comparison">
<p class="description">ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ã«ã¯ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›ãŒå¿…è¦ã§ã™</p>

<div class="comparison-sections">
<div class="section">
<h4>ğŸ¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«</h4>

```scala
case class Staff(
  id:       Staff.Id,
  name:     Staff.Name,
  username: Option[Staff.Username],
  email:    Staff.EmailAddress,
  role:     Staff.Role
)
```

</div>

<div class="section">
<h4>ğŸ—„ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒ</h4>

```sql
CREATE TABLE IF NOT EXISTS `staffs` (
  `id` BINARY(16) PRIMARY KEY,
  `family_name` VARCHAR(32) NOT NULL,
  `given_name` VARCHAR(32),
  `email` VARCHAR(255) NOT NULL UNIQUE,
  `email_validated` BOOLEAN NOT NULL DEFAULT FALSE,
  `username` VARCHAR(16) UNIQUE,
  `role` VARCHAR(20) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_email` (`email`),
  INDEX `idx_username` (`username`)
);
```

</div>
</div>
</div>

<style>
.model-schema-comparison .description {
  color: #475569;
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.model-schema-comparison .comparison-sections {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  max-width: 100%;
}

.model-schema-comparison .section {
  background: #f8fafc;
  padding: 0.75rem;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  overflow: hidden;
}

.model-schema-comparison .section h4 {
  color: #1e293b;
  font-size: 0.9rem;
  margin-bottom: 0.75rem;
}

.model-schema-comparison .section pre {
  font-size: 0.65rem;
  line-height: 1.3;
  overflow-x: auto;
}

.model-schema-comparison .section .note {
  margin-top: 1rem;
  font-size: 0.85rem;
  color: #64748b;
}
</style>

---
layout: default
---

# doobie ã®å‹ã‚¯ãƒ©ã‚¹: Put/Get/Meta

<div class="type-class-explanation">
<p class="description">doobie ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–“ã®å¤‰æ›ã‚’å‹ã‚¯ãƒ©ã‚¹ã§æŠ½è±¡åŒ–ã—ã¦ã„ã¾ã™</p>

<div class="type-classes">
<div class="type-class">
<h4>ğŸ”µ Put å‹ã‚¯ãƒ©ã‚¹</h4>
<p>ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ æ°¸ç¶šåŒ–ç”¨ã®ãƒ‡ãƒ¼ã‚¿å‹</p>
<p class="example">ä¾‹: Staff.FamilyName â†’ String</p>
<p class="note">ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã‚’DBã«ä¿å­˜ã§ãã‚‹å½¢ã«å¤‰æ›</p>
</div>

<div class="type-class">
<h4>ğŸŸ¢ Get å‹ã‚¯ãƒ©ã‚¹</h4>
<p>æ°¸ç¶šåŒ–ç”¨ã®ãƒ‡ãƒ¼ã‚¿å‹ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«</p>
<p class="example">ä¾‹: String â†’ Staff.FamilyName</p>
<p class="note">DBã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã«å¤‰æ›</p>
</div>

<div class="type-class">
<h4>ğŸŸ£ Meta å‹ã‚¯ãƒ©ã‚¹</h4>
<p>Get ã¨ Put ã‚’ã¾ã¨ã‚ãŸã‚‚ã®</p>
<p class="example">åŒæ–¹å‘ã®å¤‰æ›ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ãŸå‹ã‚¯ãƒ©ã‚¹</p>
<p class="note">ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ â‡„ DBå‹ã®ç›¸äº’å¤‰æ›ã‚’å®šç¾©</p>
</div>
</div>

<p class="footer-note">ã“ã‚Œã‚‰ã® Meta ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ Opaque Typesã€ç›´ç©å‹ã€ç›´å’Œå‹ã”ã¨ã«å®šç¾©ã—ã¦ã„ãã¾ã™</p>
</div>

<style>
.type-class-explanation .description {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.1rem;
}

.type-class-explanation .type-classes {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.type-class-explanation .type-class {
  background: #f8fafc;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.type-class-explanation .type-class h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 0.5rem;
}

.type-class-explanation .type-class p {
  color: #475569;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.type-class-explanation .type-class .example {
  color: #1e40af;
  font-size: 0.85rem;
  margin-bottom: 0.3rem;
}

.type-class-explanation .type-class .note {
  font-size: 0.8rem;
  color: #64748b;
  margin: 0;
}

.type-class-explanation .footer-note {
  color: #475569;
  font-size: 1rem;
  text-align: center;
  margin-top: 1rem;
}
</style>

---
layout: default
---

# Meta ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å®šç¾©

<div class="meta-patterns">
<p class="description">ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã«å¿œã˜ãŸ Meta ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å®šç¾©æ–¹æ³•</p>

<div class="patterns-grid">
<div class="pattern">
<h4>ğŸ·ï¸ Opaque Types</h4>
```scala
// Stringå‹ã®åˆ¶ç´„ä»˜ãå‹
given Meta[Staff.FamilyName] = 
  Meta[String].timap(
    Staff.FamilyName.applyUnsafe
  )(_.value)

// UUIDå‹
given Meta[Staff.Id] = 
  Meta[String].timap(str =>
    Staff.Id.fromUUID(
      UUID.fromString(str)
    )
  )(_.value.toString)
```
<p class="note">åŸºæœ¬å‹ã¨ã®ç›¸äº’å¤‰æ›ã‚’å®šç¾©</p>
</div>

<div class="pattern">
<h4>ğŸ“¦ Case Classï¼ˆç›´ç©å‹ï¼‰</h4>
```scala
// å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®MetaãŒå®šç¾©æ¸ˆã¿ãªã‚‰
// doobieãŒè‡ªå‹•çš„ã«å°å‡º
case class Staff.Name(
  familyName: FamilyName,
  givenName: Option[GivenName]
)

// SQLã§ç›´æ¥åˆ©ç”¨å¯èƒ½
sql"""SELECT family_name, given_name 
     FROM staffs"""
  .query[Staff.Name]
```
</div>

<div class="pattern">
<h4>ğŸ¯ Enum / Sealed Traitï¼ˆç›´å’Œå‹ï¼‰</h4>
```scala
// Enumå‹ã®å¤‰æ›
given Meta[Staff.Role] = 
  Meta[String].tiemap(str => 
    Staff.Role.find(str)
      .toRight(s"Unknown: $str")
  )(_.value)

// Unionå‹ã®å ´åˆã¯å€‹åˆ¥ã«
// Metaã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å®šç¾©
```
</div>
</div>
</div>

<style>
.meta-patterns .patterns-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.meta-patterns .pattern {
  background: #f8fafc;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.meta-patterns .pattern h4 {
  color: #1e293b;
  font-size: 0.95rem;
  margin-bottom: 0.75rem;
}

.meta-patterns .pattern pre {
  font-size: 0.65rem;
  line-height: 1.3;
  margin-bottom: 0.5rem;
  max-height: 200px;
  overflow-y: auto;
}

.meta-patterns .pattern .note {
  font-size: 0.8rem;
  color: #64748b;
  margin: 0;
}

.meta-patterns .summary {
  background: #fef3c7;
  border: 1px solid #fde68a;
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
  color: #92400e;
  font-size: 0.95rem;
}
</style>

---
layout: default
---

# EventPublisher: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…

<div class="publisher-comparison">
<p>ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œã®æŠ½è±¡åŒ–ã¨ç’°å¢ƒåˆ¥ã®å®Ÿè£…</p>

<div class="comparison-sections">
<div class="section">
<h4>ğŸ¯ EventPublisher</h4>

```scala
trait EventPublisher[F[_]]:
  def publish[E <: Event](event: E): F[Unit]
```

</div>

<div class="section">
<h4>ğŸ”§ ç’°å¢ƒåˆ¥å®Ÿè£…</h4>

```scala
// æœ¬ç•ªç’°å¢ƒç”¨
class AwsSnsEventPublisher[F[_]: Async](
  client: SnsClient,
  topicArn: String
) extends EventPublisher[F]:
  def publish[E <: Event](event: E): F[Unit] = 
    // AWS SNSã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡

// ãƒ†ã‚¹ãƒˆç’°å¢ƒç”¨
class InMemoryEventPublisher[F[_]: Sync] 
  extends EventPublisher[F]:
  private val events = mutable.ArrayBuffer.empty[Event]
  
  def publish[E <: Event](event: E): F[Unit] = 
    Sync[F].delay(events += event)
```

</div>
</div>
</div>

<style>
.publisher-comparison .comparison-sections {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.publisher-comparison .section h4 {
  color: #1e293b;
  font-size: 1.05rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
}

.publisher-comparison .section pre {
  font-size: 0.75rem;
  line-height: 1.4;
  margin-bottom: 1rem;
}
</style>

---
layout: center
class: text-center
---

# Part 4
## çµ±åˆ

- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…ã®ç¹‹ãè¾¼ã¿
- Web API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹å®‰å…¨ãªå®šç¾©

<style>
  .slidev-layout {
    background: #1e293b;
  }
  h1, h2, p, ul, li {
    color: white;
  }
</style>

---
layout: default
---

# çµ±åˆ: ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

<div class="entrypoint-overview">
<p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã¨å„å±¤ã®çµ±åˆ</p>

<div class="integration-points">
<div class="point">
<h4>ğŸŒ Web API ã®å…¥å‡ºåŠ›å®šç¾©</h4>
<ul>
<li>ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å‹å®‰å…¨æ€§ã‚’æ´»ç”¨ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</li>
<li><a href="https://github.com/softwaremill/tapir" target="_blank">tapir</a> ã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©</li>
</ul>
</div>

<div class="point">
<h4>ğŸš€ HTTPã‚µãƒ¼ãƒãƒ¼èµ·å‹•</h4>
<ul>
<li><a href="https://github.com/http4s/http4s" target="_blank">http4s</a> ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…</li>
<li>tapirã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°çµ„ã¿è¾¼ã¿</li>
</ul>
</div>

<div class="point">
<h4>ğŸ”§ ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰</h4>
<ul>
<li>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã¨ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®çµåˆ</li>
<li>DIã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã‚ãšæ‰‹å‹•ã§çµ„ã¿ç«‹ã¦</li>
</ul>
</div>
</div>
</div>

<style>
.integration-points {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
}

.point {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 1.5rem;
}

.point h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 1rem;
}

.point ul {
  list-style: none;
  padding-left: 0;
}

.point li {
  padding: 0.3rem 0;
  color: #64748b;
  padding-left: 1.25rem;
  position: relative;
  font-size: 0.9rem;
}

.point li:before {
  content: "â€¢";
  position: absolute;
  left: 0;
  color: #3b82f6;
}

.point a {
  color: #3b82f6;
  text-decoration: none;
}

.point a:hover {
  text-decoration: underline;
}
</style>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©

<div class="api-definition">
<p>è·å“¡ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜</p>

<div class="api-examples">
<div class="example-block">
<h4>ğŸ“¥ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h4>
<pre><code class="language-json">{
  "name": {
    "familyName": "å±±ç”°",
    "givenName": "å¤ªéƒ"
  },
  "email": "taro.yamada@example.com",
  "role": "manager"
}</code></pre>
</div>

<div class="example-block">
<h4>ğŸ“¤ ãƒ¬ã‚¹ãƒãƒ³ã‚¹</h4>
<pre><code class="language-json">{
  "id": "12345678-1234-5678-123456789012",
  "name": {
    "familyName": "å±±ç”°",
    "givenName": "å¤ªéƒ"
  },
  "email": {
    "value": "taro.yamada@example.com",
    "isValidated": false
  },
  "role": "manager",
  "username": null
}</code></pre>
</div>
</div>
</div>

<style>
.api-examples {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.example-block {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 1.5rem;
}

.example-block h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 1rem;
}

.example-block pre {
  font-size: 0.85rem;
  line-height: 1.4;
  background: #ffffff;
  border: 1px solid #e2e8f0;
  border-radius: 4px;
  padding: 1rem;
  overflow-x: auto;
}

.example-block code {
  color: #1e293b;
}
</style>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆ

<div class="request-definition">
<p>JSONãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã«å¤‰æ›ï¼ˆ<a href="https://github.com/circe/circe" target="_blank">circe</a> ã‚’ä½¿ç”¨ï¼‰</p>

<div class="decoder-flow">
<div class="flow-diagram">
<div class="flow-step">JSON</div>
<div class="flow-arrow">â†’</div>
<div class="flow-step">Decoder</div>
<div class="flow-arrow">â†’</div>
<div class="flow-step">CreateStaffRequest</div>
</div>
</div>

<div class="code-section">
<div class="code-block">
<h4>ğŸ“ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹å®šç¾©</h4>
```scala
case class CreateStaffRequest(
  name:  Staff.Name,  // ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã‚’ç›´æ¥ä½¿ç”¨
  email: Staff.Email, // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿
  role:  Staff.Role   // å‹å®‰å…¨ãªEnum
)
```
</div>

<div class="code-block">
<h4>ğŸ”„ Decoderã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</h4>
```scala

// Refinement Types / Enum
given Decoder[Staff.Email] = Decoder[String].emap(Staff.Email.either)
given Decoder[Staff.Role] = Decoder[String].emap { value =>
  Staff.Role.find(value).toRight(s"Invalid role: $value")
}

// ç›´ç©å‹ã®è‡ªå‹•å°å‡º
given Decoder[Staff.Name] = deriveDecoder[Staff.Name]

// å…¨ä½“ã®Decoder
given Decoder[CreateStaffRequest] = deriveDecoder[CreateStaffRequest]
```
</div>
</div>
</div>

<style>
.decoder-flow {
  background: #f0f9ff;
  border: 1px solid #bae6fd;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.flow-diagram {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.75rem;
}

.flow-step {
  background: #ffffff;
  border: 2px solid #3b82f6;
  border-radius: 6px;
  padding: 0.3rem 1rem;
  font-weight: 600;
  color: #1e293b;
  font-size: 0.9rem;
}

.flow-arrow {
  color: #3b82f6;
  font-size: 1.25rem;
  font-weight: bold;
}

.code-section {
  display: grid;
  grid-template-columns: 1fr 1.5fr;
  gap: 1rem;
}

.code-block {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 0.75rem;
}

.code-block h4 {
  color: #1e293b;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.code-block pre {
  font-size: 0.7rem;
  line-height: 1.3;
  margin: 0;
}
</style>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹

<div class="response-definition">
<p>ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã‚’JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¤‰æ›</p>

<div class="encoder-flow">
<div class="flow-diagram">
<div class="flow-step">StaffResponse</div>
<div class="flow-arrow">â†’</div>
<div class="flow-step">Encoder</div>
<div class="flow-arrow">â†’</div>
<div class="flow-step">JSON</div>
</div>
</div>

<div class="code-section">
<div class="code-block">
<h4>ğŸ“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹å®šç¾©</h4>
```scala
case class StaffResponse(
  id:       Staff.Id,               // UUIDå‹
  name:     Staff.Name,             // ç›´ç©å‹
  email:    Staff.EmailAddress,     // ç›´å’Œå‹  
  role:     Staff.Role,             // Enumå‹
  username: Option[Staff.Username]  // Optionå‹
)
```
</div>

<div class="code-block">
<h4>ğŸ”„ Encoderã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</h4>
```scala
// Opaque Types / Refinement Types / Enum
given Encoder[Staff.Id] = Encoder[UUID].contramap(_.value)
given Encoder[Staff.Email] = Encoder[String].contramap(_.value)
given Encoder[Staff.Role] = Encoder[String].contramap(_.value)

// ç›´ç©å‹ã®è‡ªå‹•å°å‡º
given Encoder[Staff.Name] = deriveEncoder[Staff.Name]

// å…¨ä½“ã®Encoder
given Encoder[StaffResponse] = deriveEncoder[StaffResponse]
```
</div>
</div>
</div>

<style>
.encoder-flow {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.encoder-flow .flow-diagram {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.75rem;
}

.encoder-flow .flow-step {
  background: #ffffff;
  border: 2px solid #22c55e;
  border-radius: 6px;
  padding: 0.3rem 1rem;
  font-weight: 600;
  color: #1e293b;
  font-size: 0.9rem;
}

.encoder-flow .flow-arrow {
  color: #22c55e;
  font-size: 1.25rem;
  font-weight: bold;
}

.response-definition .code-section {
  display: grid;
  grid-template-columns: 1fr 1.5fr;
  gap: 1rem;
}

.response-definition .code-block {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 0.75rem;
}

.response-definition .code-block h4 {
  color: #1e293b;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.response-definition .code-block pre {
  font-size: 0.7rem;
  line-height: 1.3;
  margin: 0;
}

.encoding-note {
  background: #fef3c7;
  border: 1px solid #fde68a;
  border-radius: 8px;
  padding: 0.75rem;
  text-align: center;
  margin-top: 1rem;
  font-size: 0.9rem;
  color: #92400e;
}

.encoding-note strong {
  color: #78350f;
}
</style>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©ï¼šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©

<div class="schema-definition">
<p>tapirã®Schemaå®šç¾©ã§Web APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆ</p>

<div class="schema-examples">
<div class="schema-block">
<h4>ğŸ·ï¸ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã®Schemaå®šç¾©</h4>
```scala
// Refinement Types
given Schema[Staff.FamilyName] = Schema
  .string[Staff.FamilyName]
  .description("å§“")
  .validate(Validator.minLength(1))
  .validate(Validator.maxLength(32))

// Enum
given Schema[Staff.Role] = Schema
  .string[Staff.Role]
  .description("è·å“¡ãƒ­ãƒ¼ãƒ«")
  .validate(Validator.enumeration(
    List("manager", "member"), 
    v => Some(v.value)
  ))
```
</div>

<div class="schema-block">
<h4>ğŸ”„ è‡ªå‹•å°å‡º</h4>
```scala
// case classã¯è‡ªå‹•å°å‡ºå¯èƒ½
given Schema[CreateStaffRequest] = 
  Schema.derived[CreateStaffRequest]

given Schema[StaffResponse] = 
  Schema.derived[StaffResponse]
```
</div>
</div>

<div class="swagger-preview">
<img src="/images/swagger_create_staff_request.png" alt="Swagger UI Preview" />
</div>
</div>

<style>
.schema-examples {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 1rem;
}

.schema-block {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 0.75rem;
}

.schema-block h4 {
  color: #1e293b;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.schema-block pre {
  font-size: 0.7rem;
  line-height: 1.3;
  margin: 0;
}

.swagger-preview {
  position: absolute;
  bottom: 1rem;
  right: 1rem;
  width: 260px;
}

.swagger-preview img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  border: 1px solid #e2e8f0;
}
</style>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©ï¼šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©

<div class="endpoint-definition">
<p>tapirã«ã‚ˆã‚‹å‹å®‰å…¨ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©</p>

```scala
val createStaffEndpoint: PublicEndpoint[
  CreateStaffRequest,  // å…¥åŠ›
  APIError,           // ã‚¨ãƒ©ãƒ¼
  StaffResponse,      // å‡ºåŠ›
  Any
] = endpoint.post
  .in("api" / "staffs")
  .in(jsonBody[CreateStaffRequest])
  .out(jsonBody[StaffResponse])
  .errorOut(
    oneOf[APIError](
      oneOfVariant(statusCode(BadRequest).and(jsonBody[APIError])),
      oneOfVariant(statusCode(InternalServerError).and(jsonBody[APIError]))
    )
  )
  .summary("æ–°è¦è·å“¡ã‚’ä½œæˆ")
  .description("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
```

</div>

---
layout: default
---

# Web API ã®å…¥å‡ºåŠ›ã®å®šç¾©ï¼šå‡¦ç†å®Ÿè£…

<div class="logic-definition">
<p>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¥ç¶š</p>

```scala
def createStaffServerLogic[F[_]: Async](
  service: CreateStaffService[F]
): CreateStaffRequest => F[Either[APIError, StaffResponse]] = dto => {
  val command = CreateStaffRequest.toCommand(dto)
  
  service.create(command).map {
    case Right(event) =>
      Right(StaffResponse.fromEvent(event))
      
    case Left(CreateStaffError.EmailAlreadyExists(email)) =>
      Left(APIError(
        error = "Email already exists",
        details = Some(s"${email.value} is already registered")
      ))
      
    case Left(CreateStaffError.Unexpected(ex)) =>
      Left(APIError(
        error = "Internal server error",
        details = Some(ex.getMessage)
      ))
  }
}
```
</div>

---
layout: default
---

# HTTP ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š

```scala
for
  ...
  // ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  allEndpoints = staffsEndpoints ++ swaggerEndpoints
  
  // HTTPãƒ«ãƒ¼ãƒˆ
  routes = Http4sServerInterpreter[IO]().toRoutes(allEndpoints)
  
  httpApp = ServerLogger.httpApp(logHeaders = true, logBody = false)(
              routes.orNotFound
            )
  
  server <- EmberServerBuilder
             .default[IO]
             .withHost(config.serverHost)
             .withPort(config.serverPort)
             .withHttpApp(httpApp)
             .build
yield ()
```

---
layout: default
---

# ä¾å­˜é–¢ä¿‚ã®çµ„ã¿ç«‹ã¦

ã™ã¹ã¦ã®å®Ÿè£…ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ‰‹å‹•ã§çµ„ã¿ç«‹ã¦ã‚‹ã®ã¯å†—é•·ã«ãªã‚‹ãŸã‚ã€MacWire ãªã©ã® DI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„éƒ¨åˆ†é©ç”¨ã‚’è¡Œã†å½¢ã§ä¾å­˜é–¢ä¿‚ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ (å‰²æ„›)ã€‚

```scala
// ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
val staffRepository: StaffRepository[IO] = new StaffRepositoryImpl(xa)
val eventPublisher:  EventPublisher[IO]  = new AwsSnsEventPublisher(snsClient, config.snsTopicArn)
val idGenerator:     IdGenerator[IO]     = IdGenerator.uuid[IO]
val timeProvider:    TimeProvider[IO]    = TimeProvider.system[IO]
                                                                                                   
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
val createStaffService: CreateStaffService[IO] = new CreateStaffServiceImpl[IO](
  staffRepository,
  eventPublisher,
  idGenerator,
  timeProvider
)

// ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
val staffsEndpoints = List(
  StaffsAPI.createStaffEndpoint.serverLogic(
    StaffsAPI.createStaffServerLogic(services.createStaffService)
  )
)
```

---
layout: default
---

# å‹•ä½œç¢ºèª

<div class="api-demo">

```scala
scala-cli run samples/scripts/http4s_server.sc
```

<div class="demo-examples">
<div class="example">
<h4>âœ… æ­£å¸¸ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h4>
```bash
curl -X POST http://localhost:8080/api/staffs \
  -H 'Content-Type: application/json' \
  -d '{
    "name": {
      "familyName": "å±±ç”°",
      "givenName": "å¤ªéƒ"
    },
    "email": "yamada@example.com",
    "role": "member"
  }'
```
<div class="response success">
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": {"familyName": "å±±ç”°", "givenName": "å¤ªéƒ"},
  "email": "yamada@example.com",
  "role": "member"
}
```
</div>
</div>

<div class="example">
<h4>âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼</h4>
```bash
curl -X POST http://localhost:8080/api/staffs \
  -H 'Content-Type: application/json' \
  -d '{
    "name": {"familyName": ""}, 
    "email": "invalid-email",
    "role": "admin"
  }'
```
<div class="response error">
```json
{
  "error": "Validation failed",
  "details": "Invalid email format"
}
```
</div>
</div>
</div>
</div>

<style>
.api-demo .description {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
  text-align: center;
}

.demo-examples {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
}

.example h4 {
  color: #1e293b;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.example pre {
  font-size: 0.7rem;
  line-height: 1.3;
}

.response {
  margin-top: 0.5rem;
  padding: 0.75rem;
  border-radius: 6px;
  font-size: 0.75rem;
}

.response.success {
  background: #d1fae5;
  border: 1px solid #6ee7b7;
}

.response.error {
  background: #fee2e2;
  border: 1px solid #f87171;
}

.type-safety-summary {
  background: #f0f9ff;
  border: 1px solid #bae6fd;
  border-radius: 8px;
  padding: 1.25rem;
  text-align: center;
}

.type-safety-summary strong {
  color: #0369a1;
  font-size: 1.05rem;
  display: block;
  margin-bottom: 0.5rem;
}

.type-safety-summary p {
  color: #075985;
  font-size: 0.95rem;
  margin: 0;
}
</style>

---
layout: default
---

# ã¾ã¨ã‚

<div class="summary-container">

<div class="key-points">
<div class="point">
<div class="icon">ğŸ¯</div>
<h3>ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã®è¨­è¨ˆ</h3>
<ul>
<li>Refinement Types (iron)</li>
<li>Opaque Types</li>
<li>case class</li>
<li>Enum / sealed trait / Union Types</li>
</ul>
</div>

<div class="point">
<div class="icon">ğŸ—ï¸</div>
<h3>ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ</h3>
<ul>
<li>ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆç´”ç²‹ãªå‹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰</li>
<li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰</li>
<li>ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼ˆå‰¯ä½œç”¨ã®å®Ÿè£…ï¼‰</li>
<li>ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆWeb APIï¼‰</li>
</ul>
</div>

<div class="point">
<div class="icon">ğŸ”—</div>
<h3>å‹å®‰å…¨ãªå®Ÿè£…</h3>
<ul>
<li>tapirã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©</li>
<li>OpenAPIã‚¹ã‚­ãƒ¼ãƒè‡ªå‹•ç”Ÿæˆ</li>
<li>doobieã«ã‚ˆã‚‹å‹å®‰å…¨ãªDBæ“ä½œ</li>
</ul>
</div>
</div>

<div class="tech-stack">
<h3>ä½¿ç”¨ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h3>
<div class="stack-items">
<div class="stack-category">
<strong>å‹å®šç¾©</strong>
<span>iron, Scala 3æ¨™æº–</span>
</div>
<div class="stack-category">
<strong>Web API</strong>
<span>tapir, http4s</span>
</div>
<div class="stack-category">
<strong>JSONå¤‰æ›</strong>
<span>circe</span>
</div>
<div class="stack-category">
<strong>æ°¸ç¶šåŒ–/ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ</strong>
<span>doobie, Cats Effect (IO)</span>
</div>
</div>
</div>
</div>

<style>
.summary-container {
  max-width: 1200px;
  margin: 0 auto;
}

.summary-container h2 {
  color: #1e293b;
  text-align: center;
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.key-points {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.point {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 1rem;
  transition: transform 0.2s, box-shadow 0.2s;
}

.point:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.point .icon {
  font-size: 1.5rem;
  text-align: center;
  margin-bottom: 0.25rem;
}

.point h3 {
  color: #1e293b;
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
  text-align: center;
}

.point ul {
  list-style: none;
  padding: 0;
}

.point li {
  color: #64748b;
  font-size: 0.75rem;
  padding: 0.15rem 0;
  padding-left: 0.75rem;
  position: relative;
}

.point li:before {
  content: "â€¢";
  position: absolute;
  left: 0;
  color: #3b82f6;
}

.tech-stack {
  background: #eff6ff;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.tech-stack h3 {
  color: #1e40af;
  text-align: center;
  margin-bottom: 0.75rem;
  font-size: 1rem;
}

.stack-items {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.5rem;
}

.stack-category {
  text-align: center;
  padding: 0.5rem;
  background: white;
  border-radius: 6px;
  border: 1px solid #dbeafe;
}

.stack-category strong {
  display: block;
  color: #1e40af;
  font-size: 0.75rem;
  margin-bottom: 0.25rem;
}

.stack-category span {
  color: #64748b;
  font-size: 0.7rem;
}

.benefits {
  background: #f0fdf4;
  border-radius: 8px;
  padding: 1rem;
}

.benefits h3 {
  color: #14532d;
  text-align: center;
  margin-bottom: 0.75rem;
  font-size: 1rem;
}

.benefit-items {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
}

.benefit {
  text-align: center;
  background: white;
  padding: 0.75rem;
  border-radius: 6px;
  border: 1px solid #bbf7d0;
}

.benefit strong {
  display: block;
  color: #15803d;
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.benefit p {
  color: #16a34a;
  font-size: 0.75rem;
  margin: 0;
}
</style>

---
layout: center
class: text-center
---

# Part A
## Appendix

<style>
  .slidev-layout {
    background: #1e293b;
  }
  h1, h2 {
    color: white;
  }
</style>

---
layout: default
---

<div class="grid grid-cols-2 gap-6">
<div>

### Play Framework

Scala / Java å‘ã‘ã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãª Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚

- **ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³**: å¿…è¦ãªæ©Ÿèƒ½ãŒæœ€åˆã‹ã‚‰æƒã£ã¦ã„ã‚‹
- **é«˜é€Ÿãªé–‹ç™ºé–‹å§‹**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§å³åº§ã«ã‚¹ã‚¿ãƒ¼ãƒˆ
- **è±Šå¯Œãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: æˆç†Ÿã—ãŸã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- **è¨­å®šã®è‡ªå‹•åŒ–**: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãªã©

</div>
<div>

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®çµ„ã¿åˆã‚ã›

å€‹åˆ¥ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’çµ„ã¿åˆã‚ã›ã¦æ§‹ç¯‰ã€‚

- **è»½é‡æ€§**: å¿…è¦ãªæ©Ÿèƒ½ã®ã¿ã‚’é¸æŠ
- **å­¦ç¿’æ©Ÿä¼š**: å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ·±ã„ç†è§£
- **ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³å›é¿**: ç‰¹å®šãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„
- **åˆæœŸè¨­å®šã®æ‰‹é–“**: å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®çµ±åˆä½œæ¥­
- **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: è¤‡æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç¿’å¾—ãŒå¿…è¦
- **è¨­è¨ˆã®è²¬ä»»**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¸å®šã®è‡ªç”±åº¦ãŒé«˜ã„

</div>
</div>

---
layout: default
---

# ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®é¸æŠ

### Future
- âœ… Scala æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«çµ„ã¿è¾¼ã¿
- âŒ å³åº§ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆå‚ç…§é€éæ€§ãŒãªã„ï¼‰
- âŒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé™å®šçš„

### IO
- âœ… ç´”ç²‹é–¢æ•°å‹ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- âœ… è±Šå¯Œãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- âœ… å‹ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã§æ‹¡å¼µæ€§ãŒé«˜ã„

### ZIO
- âœ… ã‚¨ãƒ©ãƒ¼å‹ã‚’æ˜ç¤ºçš„ã«æ‰±ãˆã‚‹ï¼ˆZIO[R, E, A]ï¼‰
- âœ… çµ±åˆã•ã‚ŒãŸã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
